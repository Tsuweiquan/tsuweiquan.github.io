<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://tsuweiquan.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://tsuweiquan.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-01-25T06:29:22+00:00</updated><id>https://tsuweiquan.github.io/feed.xml</id><title type="html">blank</title><subtitle></subtitle><entry><title type="html">Terragrunt</title><link href="https://tsuweiquan.github.io/blog/2025/terragrunt/" rel="alternate" type="text/html" title="Terragrunt"/><published>2025-01-24T00:00:00+00:00</published><updated>2025-01-24T00:00:00+00:00</updated><id>https://tsuweiquan.github.io/blog/2025/terragrunt</id><content type="html" xml:base="https://tsuweiquan.github.io/blog/2025/terragrunt/"><![CDATA[<h1 id="pre-requisite-terraform">Pre-requisite: Terraform</h1> <p>Before understanding more about Terragrunt, it is required to know what is terraform and how can Terragrunt solve some issues in Terraform.</p> <p>Terraform, an infrastructure as code tool that lets you define both cloud and on-prem resources in human-readable configuration files that you can version, reuse, and share.</p> <ul> <li>Ref: https://developer.hashicorp.com/terraform/intro</li> </ul> <p>Terraform allow us to create infrastructure or cloud resources by writing a code of resource block. Undeniably, it’s a great tool when we need to create the same infrastructure across different environment. We just need to apply the same configuration or code block across different environment, and we should expect the configuration of the infrastructure to be equal across different environments.</p> <p>A typical yet simplest terraform folder structure will look like the following, where each environment would have their own state file (terraform.tfstate). Resources meant to be created in that environment should be written to its respective folder.</p> <p>We can run terraform in the <code class="language-plaintext highlighter-rouge">terraform_root/environments/dev/</code> folder to deploy/create resources for <code class="language-plaintext highlighter-rouge">dev</code> environment, similarly for <code class="language-plaintext highlighter-rouge">staging</code> and <code class="language-plaintext highlighter-rouge">prod</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
└── terraform_root/
    ├── main.tf
    ├── variables.tf
    ├── outputs.tf
    ├── versions.tf
    ├── provider.tf
    ├── README.md
    └── environments/
        ├── dev/
        │   ├── main.tf
        │   └── terraform.tfvars
        ├── staging/
        │   ├── main.tf
        │   └── terraform.tfvars
        └── prod/
            ├── main.tf
            └── terraform.tfvars
</code></pre></div></div> <h3 id="terraform-impending-problems">Terraform Impending Problems</h3> <ul> <li>Code Duplication <ul> <li>Resources created in <code class="language-plaintext highlighter-rouge">dev</code> environment needs to be copied over to <code class="language-plaintext highlighter-rouge">staging</code> and <code class="language-plaintext highlighter-rouge">prod</code> environment. Copying of resources might look alright but when your environment scales up, this become really taxing and error-prone.</li> <li>Not a DRY (Don’t Repeat Yourself) approach.</li> <li>Very prone to Human Error</li> </ul> </li> <li>Single state per environment can be hard to manage <ul> <li>Terraform state can easily be bloated up.</li> <li><code class="language-plaintext highlighter-rouge">Terraform plan/apply/refresh</code> will take longer and longer as your infrastructure scales up</li> </ul> </li> <li>Difficult to do logical separation of projects <ul> <li>Tagging could be a hassle</li> </ul> </li> <li>Complexity increases with Region based deployments <ul> <li>If you are using AWS, how can we tweak the folder structure to accommodate deployment to different regions (<code class="language-plaintext highlighter-rouge">us-east-1</code> &amp; <code class="language-plaintext highlighter-rouge">ap-southeast-1</code>)? <ul> <li>The simplest way is to rename <code class="language-plaintext highlighter-rouge">dev</code> folder to <code class="language-plaintext highlighter-rouge">dev-us</code> and create another <code class="language-plaintext highlighter-rouge">dev-sg</code> folder. Next, copy the required code in <code class="language-plaintext highlighter-rouge">dev-us</code> into <code class="language-plaintext highlighter-rouge">dev-sg</code> and start running terraform in <code class="language-plaintext highlighter-rouge">dev-sg</code> to deploy resources in <code class="language-plaintext highlighter-rouge">ap-southeast-1</code> region. <ul> <li>This method is straight-forward but just not ideal…</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>These are the problems I faced when I was working in my organization. Terraform state becomes so huge that we start to use <code class="language-plaintext highlighter-rouge">-target=</code> arguments during <code class="language-plaintext highlighter-rouge">terraform plan</code> to speed up the deployment process. With much faster processing speed and efficiency, everyone starts to use <code class="language-plaintext highlighter-rouge">-target=</code> as the default practice, which is a BAD PRACTICE!</p> <blockquote> <p>Targeting individual resources can be useful for troubleshooting errors, but should not be part of your normal workflow.</p> </blockquote> <ul> <li>ref: <a href="https://developer.hashicorp.com/terraform/tutorials/state/resource-targeting">Target resources</a></li> </ul> <p>As time goes by, with every run becomes a target run, this results in <em>Infrastructure Drift</em>. God knows when was the last time we ran terraform apply on the entire plan, and this becomes a big problem! No engineers would take the risk to run a full sync, risking the modification or deletion of some resources that we have no idea of.</p> <p>Terragrunt can absolutely solve the issues I mentioned above!</p> <hr/> <h1 id="terragrunt">Terragrunt</h1>]]></content><author><name></name></author><category term="infrastructure-as-code"/><category term="Terragrunt"/><category term="AWS"/><category term="Terraform"/><summary type="html"><![CDATA[Setting up IaC with Terragrunt]]></summary></entry></feed>